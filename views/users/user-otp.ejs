
    <%- include('../layout/header.ejs') %>
    <!-- <h1>Your Email has been verified</h1> -->
        	<!-- NEWSLETTER -->
		<div id="newsletter" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<div class="newsletter">
							<p><strong>OTP Verification</strong></p>
							<% if(typeof message !=='undefined' ){ %>
								<h5 id="invalid-msg" class=" text-danger text-center"><%- message %></h5>
								<% } %>
							<form action="/user-otp" method="post">
								<input class="input" type="text" name="otp" placeholder="Enter Your OTP">
								<p class="text-danger mt-3">Time left: <span id="timer">60</span></p>
                                <button type="submit" class="btn btn-primary" 
                                style="border-radius: 40px 40px 40px 40px; width: 160px; height: 40px; font-weight: 700;" ><i class="fa fa-envelope"></i>  Submit </button>
								<button  id="resendButton" class="newsletter-btn">
                                    <a id="resendButtonLink" href=""></a>
                                    <i class="fa fa-envelope" onclick="resendOTP()"></i>Resend OTP</button>
							</form>
							<ul class="newsletter-follow">
								<li>
									<a href="#"><i class="fa fa-facebook"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-twitter"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-instagram"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-pinterest"></i></a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /NEWSLETTER -->

    <%-include('../layout/footer.ejs')%>


<!-- SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<!-- jQuery library -->
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->


	<script>
		 let countdown = 60; // Initial countdown value in seconds
        let timerElement = document.getElementById('timer');
        let resendButton = document.getElementById('resendButton');
        let countdownInterval;

        // Function to update the countdown timer
        function updateTimer() {
    timerElement.textContent = countdown + ' seconds';
    countdown--;

    if (countdown < 0) {
        clearInterval(countdownInterval);
        timerElement.textContent = '0 seconds';
        document.getElementById('resendButton').removeAttribute('disabled');
        document.getElementById('resendButtonLink').setAttribute('href', '/resendOtp');
    }
}

        // Function to resend OTP
        function resendOTP() {
            // Simulate OTP resend logic here
            // For example, you can make an API call to send a new OTP

            // Reset the timer
            countdown = 60;
            timerElement.textContent = countdown + ' seconds';
            resendButton.disabled = true;

            // Start the countdown again
            countdownInterval = setInterval(updateTimer, 1000);
        }

        // Initial countdown start
        countdownInterval = setInterval(updateTimer, 1000);


     setTimeout(function () {
    // Your code to hide the message after a delay goes here
    var invalidMsg = document.getElementById("invalid-msg");
    if (invalidMsg) {
      invalidMsg.style.display = "none";
    }
  }, 3000);



        $(document).ready(function () {
        $("form").submit(function (event) {
            event.preventDefault();
            const otp = $("#otp").val();

            // Make an AJAX request to verify the OTP
            $.ajax({
                type: "POST",
                url: "/user-otp",
                data: { otp: otp },
                success: function (data) {
                    if (data.success) {
                        // OTP verification was successful
                        Swal.fire({
                            title: 'Registered Successfully',
                            text: 'You have successfully verified your OTP and registered.',
                            icon: 'success',
                            timer: 2000, 
                            showConfirmButton: false 
                        }).then(function () {
                            window.location.href = '/login';
                        });
                    } else {
                        // OTP verification failed
                        Swal.fire({
                            title: 'Error',
                            text: data.message || 'Invalid OTP',
                            icon: 'error',
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred while processing your request',
                        icon: 'error',
                    });
                }
            });
        });
    });

	</script>

</body>
</html>